<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - TutorIA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #1a1a1a; /* Dark background */
            color: #e0e0e0; /* Light text for contrast */
            font-family: 'Inter', sans-serif;
        }
        .form-label {
            display: block;
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            color: #d1d5db; /* gray-300 */
            margin-bottom: 0.25rem; /* mb-1 */
        }
        .form-input, .form-select, .form-textarea {
            display: block;
            width: 100%;
            padding: 0.5rem 0.75rem; /* px-3 py-2 */
            background-color: #374151; /* gray-700 */
            border: 1px solid #4b5563; /* border border-gray-600 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            color: #ffffff; /* text-white */
            outline: none; /* focus:outline-none */
            transition: all 200ms ease-in-out; /* transition-all duration-200 */
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: #3b82f6; /* focus:border-blue-500 */
            box-shadow: 0 0 0 1px #3b82f6; /* focus:ring-1 focus:ring-blue-500 */
        }
        .form-checkbox {
            height: 1rem; /* h-4 */
            width: 1rem; /* w-4 */
            color: #3b82f6; /* text-blue-500 */
            border-color: #4b5563; /* border-gray-600 */
            border-radius: 0.25rem; /* rounded */
            background-color: #374151; /* bg-gray-700 */
            outline: none; /* focus:outline-none */
        }
        .form-checkbox:focus {
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.5); /* focus:ring-blue-500 */
        }
        .help-text {
            margin-top: 0.125rem; /* mt-0.5 */
            font-size: 0.75rem; /* text-xs */
            color: #9ca3af; /* gray-400 */
            opacity: 0.8; /* opacity-80 */
        }
        .card {
            background-color: #374151; /* bg-gray-800 */
            padding: 1.5rem; /* p-6 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
            transition: box-shadow 300ms ease-in-out; /* transition-shadow duration-300 */
            border: 1px solid #4b5563; /* border border-gray-700 */
        }
        .card:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); /* hover:shadow-xl */
        }
        .btn {
            padding: 0.5rem 1rem; /* px-4 py-2 */
            border-width: 1px; /* border */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            font-size: 0.875rem; /* text-sm */
            font-weight: 500; /* font-medium */
            outline: none; /* focus:outline-none */
        }
        .btn:focus {
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.5), 0 0 0 4px rgba(0, 0, 0, 0.5); /* focus:ring-2 focus:ring-offset-2 */
        }
        .btn-primary {
            border-color: transparent; /* border-transparent */
            color: #ffffff; /* text-white */
            background-color: #2563eb; /* bg-blue-600 */
        }
        .btn-primary:hover {
            background-color: #1d4ed8; /* hover:bg-blue-700 */
        }
        .btn-primary:focus {
            box-shadow: 0 0 0 2px #3b82f6, 0 0 0 4px #1f2937; /* focus:ring-blue-500 focus:ring-offset-gray-800 */
        }
        .btn-secondary {
            border-color: #4b5563; /* border-gray-600 */
            color: #d1d5db; /* text-gray-300 */
            background-color: #374151; /* bg-gray-700 */
        }
        .btn-secondary:hover {
            background-color: #4b5563; /* hover:bg-gray-600 */
        }
        .btn-secondary:focus {
            box-shadow: 0 0 0 2px #6366f1, 0 0 0 4px #1f2937; /* focus:ring-indigo-500 focus:ring-offset-gray-800 */
        }
        .slider-track {
            -webkit-appearance: none;
            width: 100%; /* w-full */
            height: 0.5rem; /* h-2 */
            background-color: #4b5563; /* bg-gray-600 */
            border-radius: 0.5rem; /* rounded-lg */
        }
        .slider-thumb {
            -webkit-appearance: none;
            width: 1.25rem; /* w-5 */
            height: 1.25rem; /* h-5 */
            background-color: #2563eb; /* bg-blue-600 */
            border-radius: 9999px; /* rounded-full */
            cursor: pointer;
        }
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }
        .sidebar-nav-item {
            display: flex;
            align-items: center;
            padding: 0.5rem; /* p-2 */
            border-radius: 0.375rem; /* rounded-md */
            transition: background-color 200ms ease-in-out, color 200ms ease-in-out; /* transition-colors duration-200 */
        }
        .sidebar-nav-item.active {
            background-color: #4b5563; /* bg-gray-700 */
            color: #ffffff; /* text-white */
        }
        .sidebar-nav-item:not(.active) {
            color: #9ca3af; /* text-gray-400 */
        }
        .sidebar-nav-item:not(.active):hover {
            background-color: #4b5563; /* hover:bg-gray-700 */
            color: #ffffff; /* hover:text-white */
        }
        .content-panel {
            display: none;
        }
        .content-panel.active {
            display: block;
        }
    </style>
</head>
<body class="text-gray-200 flex min-h-screen flex-col">

    <div id="toast" class="fixed top-5 right-5 bg-green-600 text-white py-2 px-4 rounded-lg shadow-md opacity-0 invisible transition-all duration-500 z-50">
        <p id="toast-message"></p>
    </div>

    <!-- Modal for Add Model -->
    <div id="add-model-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-gray-700">
            <h3 class="text-xl font-semibold text-white mb-4">A√±adir Nuevo Modelo</h3>
            <input type="text" id="new-model-input" class="form-input mb-4" placeholder="Nombre del modelo">
            <div class="flex justify-end space-x-4">
                <button id="cancel-add-model" class="btn btn-secondary">Cancelar</button>
                <button id="confirm-add-model" class="btn btn-primary">A√±adir</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Header -->
    <header class="bg-gray-900 p-4 shadow-md">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-2xl font-bold text-gray-100">Admin Panel</h1>
            <div class="flex space-x-4">
                <!-- Updated button text and removed border classes -->
                <button class="text-gray-400 hover:text-white font-semibold">Administraci√≥n de Usuarios</button>
                <button class="text-white font-semibold">Settings</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <div class="flex-grow flex flex-col p-0 w-full h-full">
        
        <div class="flex flex-grow bg-gray-800 shadow-lg border border-gray-700 overflow-hidden w-full">
            <!-- Internal Sidebar Navigation -->
            <aside class="w-56 bg-gray-900 text-gray-300 p-4 flex flex-col flex-shrink-0">
                <nav class="flex-grow">
                    <ul>
                        <li class="mb-2">
                            <a href="#" id="nav-general" class="sidebar-nav-item active">
                                <span class="mr-3">‚öôÔ∏è</span> General
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" id="nav-usuarios" class="sidebar-nav-item">
                                <span class="mr-3">üë•</span> Usuarios
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" id="nav-modelos" class="sidebar-nav-item">
                                <span class="mr-3">üß†</span> Modelos
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" id="nav-ingesta" class="sidebar-nav-item">
                                <span class="mr-3">üì•</span> Ingesta
                            </a>
                        </li>
                        <li class="mb-2">
                            <a href="#" id="nav-web-scraping" class="sidebar-nav-item">
                                <span class="mr-3">üåê</span> Web Scraping
                            </a>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- Content Panels Container -->
            <main class="flex-grow p-6 overflow-y-auto pb-20"> <!-- Added pb-20 for fixed buttons -->
                <!-- General Panel -->
                <div id="panel-general" class="content-panel active">
                    <h3 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2 text-blue-400 font-bold">ü§ñ Configuraci√≥n General</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <label for="enable-signups" class="form-label mb-0">Habilitar Registro de nuevos usuarios</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="enable-signups" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <div>
                            <label for="default-user-role" class="form-label">Rol de Usuario por Defecto</label>
                            <select id="default-user-role" class="form-select">
                                <option>Consulta</option>
                                <option>Administrador</option>
                            </select>
                            <p class="help-text">Define el rol asignado a los nuevos usuarios registrados.</p>
                        </div>
                        
                        <div>
                            <label for="jwt-expiration" class="form-label">Expiraci√≥n JWT</label>
                            <input type="number" id="jwt-expiration" value="-1" class="form-input" placeholder="-1">
                            <p class="help-text">Unidades de tiempo v√°lidas: 's' (segundos), 'm' (minutos), 'h' (horas), 'd' (d√≠as), 'w' (semanas) o '-1' para sin expiraci√≥n.</p>
                        </div>
                        <div>
                            <label for="webhook-url" class="form-label">URL de Webhook</label>
                            <input type="url" id="webhook-url" class="form-input" placeholder="https://example.com/webhook">
                            <p class="help-text">URL para enviar notificaciones autom√°ticas.</p>
                        </div>
                    </div>
                </div>

                <!-- Usuarios Panel -->
                <div id="panel-usuarios" class="content-panel">
                    <h3 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2 text-blue-400 font-bold">üë• Permisos de Usuario</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <label for="allow-chat-deletion" class="form-label mb-0">Permitir Eliminaci√≥n de Chat</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="allow-chat-deletion" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <!-- New field for "Guardar datos privados" -->
                        <div class="flex items-center justify-between">
                            <label for="save-private-data" class="form-label mb-0">Guardar datos privados</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="save-private-data" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <!-- "Gestionar Modelos" section removed from here -->
                    </div>
                </div>

                <!-- Modelos Panel (New) -->
                <div id="panel-modelos" class="content-panel">
                    <h3 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2 text-blue-400 font-bold">üß† Configuraci√≥n de Modelos</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="default-model" class="form-label">Modelo por Defecto</label>
                            <select id="default-model" class="form-select">
                                <option>Selecciona un modelo</option>
                                <option>gpt-3.5-turbo</option>
                                <option>gpt-4o</option>
                                <option>City Weather</option>
                                <!-- Add more models dynamically if needed -->
                            </select>
                            <p class="help-text">Modelo de IA predeterminado para nuevas interacciones.</p>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <label for="model-whitelisting-toggle" class="form-label mb-0">Lista Blanca de Modelos</label>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="model-whitelisting-toggle" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            <div id="model-whitelist-container" class="space-y-2 p-4 bg-gray-700 rounded-md">
                                <!-- Model whitelist items will be added here by JS -->
                            </div>
                            <button id="add-model-to-whitelist" class="btn btn-secondary mt-2">A√±adir Modelo</button>
                        </div>
                    </div>
                </div>

                <!-- Ingesta Panel -->
                <div id="panel-ingesta" class="content-panel">
                    <h3 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2 text-blue-400 font-bold">üì• Configuraci√≥n de Ingesta</h3>
                    <div class="space-y-6 mb-2">
                        <section id="vector-db-config" class="space-y-4 p-4 bg-gray-700 rounded-md border border-gray-600">
                            <h4 class="text-lg font-medium text-gray-300 font-bold">Base de Datos Vectorial</h4>
                            <div>
                                <label for="vector-db-client" class="form-label">Cliente de Base de Datos Vectorial</label>
                                <select id="vector-db-client" class="form-select">
                                    <option>Qdrant</option>
                                    <option>Pinecone</option>
                                    <option>Weaviate</option>
                                    <option>Chroma</option>
                                </select>
                                <p class="help-text">Selecciona el cliente de la base de datos vectorial a utilizar.</p>
                            </div>
                            <div>
                                <label for="vector-db-url" class="form-label">URL de Conexi√≥n</label>
                                <input type="url" id="vector-db-url" class="form-input" placeholder="ej. http://localhost:6333">
                                <p class="help-text">URL de conexi√≥n a la base de datos vectorial.</p>
                            </div>
                            <div>
                                <label for="vector-db-access-token" class="form-label">Access Token (Opcional)</label>
                                <input type="password" id="vector-db-access-token" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                <p class="help-text">Token de acceso para autenticaci√≥n (si es requerido).</p>
                            </div>
                            <div>
                                <label for="vector-db-collection" class="form-label">Colecci√≥n de Datos</label>
                                <input type="text" id="vector-db-collection" class="form-input" placeholder="ej. my_collection">
                                <p class="help-text">Nombre de la colecci√≥n o √≠ndice a utilizar.</p>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="hnsw-ef" class="form-label">N√∫mero de Vecinos (hnsw_ef)</label>
                                    <input type="number" id="hnsw-ef" value="200" class="form-input" placeholder="ej. 100-500">
                                    <p class="help-text">Controla la profundidad de la b√∫squeda en el grafo HNSW.</p>
                                </div>
                                <div>
                                    <label for="retrieve-fragments" class="form-label">Fragmentos a Recuperar (k)</label>
                                    <input type="number" id="retrieve-fragments" value="5" class="form-input" placeholder="ej. 1-10">
                                    <p class="help-text">Cantidad de fragmentos de documentos m√°s relevantes a recuperar.</p>
                                </div>
                            </div>
                            <!-- Removed "Habilitar B√∫squeda Exacta" -->
                        </section>
                    </div>

		            <h3 class="text-xl font-semibold mt-4 mb-4 border-t border-b border-gray-700 pb-2 pt-2 text-blue-400 font-bold">üì• Configuraci√≥n de Busqueda</h3>
                    <div class="space-y-6">

                        <section id="search-config" class="space-y-4 p-4 bg-gray-700 rounded-md border border-gray-600">
                            <h4 class="text-lg font-medium text-gray-300 font-bold">Configuraci√≥n de B√∫squeda</h4>
                            <div>
                                <label for="splitter-type" class="form-label">Tipo de Divisor</label>
                                <select id="splitter-type" class="form-select">
                                    <option>TokenTextSplitter</option>
                                    <option>RecursiveCharacterTextSplitter</option>
                                </select>
                                <p class="help-text">M√©todo para dividir el texto en fragmentos (chunks).</p>
                            </div>
                            <div>
                                <label for="chunk-size" class="form-label">Tama√±o del Fragmento (Tokens)</label>
                                <input type="number" id="chunk-size" value="1024" class="form-input">
                                <p class="help-text">N√∫mero m√°ximo de tokens por fragmento.</p>
                            </div>
                            <div>
                                <label for="chunk-overlap" class="form-label">Solapamiento (Tokens)</label>
                                <input type="number" id="chunk-overlap" value="200" class="form-input">
                                <p class="help-text">Tokens que se solapan entre fragmentos para mantener contexto.</p>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Web Scraping Panel -->
                <div id="panel-web-scraping" class="content-panel">
                    <h3 class="text-xl font-semibold mb-4 border-b border-gray-700 pb-2 text-blue-400 font-bold">üåê Configuraci√≥n de Web Scraping</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <label for="enable-web-search" class="form-label mb-0">Habilitar B√∫squeda Web</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="enable-web-search" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <!-- Removed "Motor de B√∫squeda Web" -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="depth-level" class="form-label">Nivel de profundidad</label>
                                <input type="number" id="depth-level" value="3" min="1" max="5" class="form-input">
                                <p class="help-text">Define la profundidad de la b√∫squeda web (m√°x. 5).</p>
                            </div>
                            <div>
                                <label for="concurrent-requests" class="form-label">Solicitudes Concurrentes</label>
                                <input type="number" id="concurrent-requests" value="10" class="form-input">
                                <p class="help-text">N√∫mero de solicitudes web simult√°neas.</p>
                            </div>
                        </div>
                        <h4 class="text-lg font-medium text-gray-300 mt-6 mb-2 font-bold">Configuraci√≥n del Cargador Web</h4>
                        <div class="flex items-center justify-between">
                            <label for="bypass-ssl-verification" class="form-label mb-0">Omitir verificaci√≥n SSL para Sitios Web</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="bypass-ssl-verification" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        <!-- Removed "Configuraci√≥n del Cargador de YouTube" section -->
                    </div>
                </div>

                <!-- Fixed Save/Reset Buttons -->
                <div class="fixed bottom-4 right-4 p-4 bg-gray-800 rounded-lg shadow-xl z-40 flex space-x-4">
                    <button id="reset-button" class="btn btn-secondary">Restablecer</button>
                    <button id="save-button" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const elements = {
                // General
                enableSignups: document.getElementById('enable-signups'),
                defaultUserRole: document.getElementById('default-user-role'),
                jwtExpiration: document.getElementById('jwt-expiration'),
                webhookUrl: document.getElementById('webhook-url'),

                // Usuarios
                allowChatDeletion: document.getElementById('allow-chat-deletion'),
                savePrivateData: document.getElementById('save-private-data'),

                // Modelos
                defaultModel: document.getElementById('default-model'),
                modelWhitelistingToggle: document.getElementById('model-whitelisting-toggle'),
                modelWhitelistContainer: document.getElementById('model-whitelist-container'),
                addModelToWhitelistButton: document.getElementById('add-model-to-whitelist'),
                addModelModal: document.getElementById('add-model-modal'),
                newModelInput: document.getElementById('new-model-input'),
                cancelAddModelButton: document.getElementById('cancel-add-model'),
                confirmAddModelButton: document.getElementById('confirm-add-model'),

                // Ingesta (Updated fields)
                vectorDbClient: document.getElementById('vector-db-client'),
                vectorDbUrl: document.getElementById('vector-db-url'),
                vectorDbAccessToken: document.getElementById('vector-db-access-token'),
                vectorDbCollection: document.getElementById('vector-db-collection'),
                optimizationScenario: document.getElementById('optimization-scenario'),
                hnswEf: document.getElementById('hnsw-ef'),
                retrieveFragments: document.getElementById('retrieve-fragments'),
                // exactSearch removed
                splitterType: document.getElementById('splitter-type'),
                chunkSize: document.getElementById('chunk-size'),
                chunkOverlap: document.getElementById('chunk-overlap'),

                // Web Scraping (Updated fields)
                enableWebSearch: document.getElementById('enable-web-search'),
                // webSearchEngine removed
                depthLevel: document.getElementById('depth-level'), // Renamed from searchResultCount
                concurrentRequests: document.getElementById('concurrent-requests'),
                bypassSslVerification: document.getElementById('bypass-ssl-verification'),
                // youtubeLanguage removed

                // Global
                saveButton: document.getElementById('save-button'),
                resetButton: document.getElementById('reset-button'),
                toast: document.getElementById('toast'),
                toastMessage: document.getElementById('toast-message'),

                // Navigation
                navButtons: {
                    general: document.getElementById('nav-general'),
                    usuarios: document.getElementById('nav-usuarios'),
                    modelos: document.getElementById('nav-modelos'),
                    ingesta: document.getElementById('nav-ingesta'),
                    webScraping: document.getElementById('nav-web-scraping'),
                },
                contentPanels: {
                    general: document.getElementById('panel-general'),
                    usuarios: document.getElementById('panel-usuarios'),
                    modelos: document.getElementById('panel-modelos'),
                    ingesta: document.getElementById('panel-ingesta'),
                    webScraping: document.getElementById('panel-web-scraping'),
                }
            };

            // Log all elements to check if any are null
            console.log('Verificando elementos HTML:');
            for (const key in elements) {
                if (elements.hasOwnProperty(key)) {
                    if (typeof elements[key] === 'object' && elements[key] !== null && !Array.isArray(elements[key])) {
                        // For nested objects like navButtons or contentPanels
                        for (const subKey in elements[key]) {
                            if (elements[key].hasOwnProperty(subKey)) {
                                console.log(`  elements.${key}.${subKey}:`, elements[key][subKey]);
                            }
                        }
                    } else {
                        console.log(`  elements.${key}:`, elements[key]);
                    }
                }
            }

            const defaultConfig = {
                // General
                enableSignups: true,
                defaultUserRole: 'Consulta',
                jwtExpiration: -1,
                webhookUrl: 'https://example.com/webhook',

                // Usuarios
                allowChatDeletion: true,
                savePrivateData: true,
                
                // Modelos
                defaultModel: 'gpt-3.5-turbo',
                modelWhitelisting: ['gpt-3.5-turbo', 'gpt-4o', 'City Weather'],

                // Ingesta (Updated defaults)
                vectorDbClient: 'Qdrant',
                vectorDbUrl: 'http://localhost:6333',
                vectorDbAccessToken: '',
                vectorDbCollection: 'my_collection',
                optimizationScenario: 'Balanced',
                hnswEf: 200,
                retrieveFragments: 5,
                // exactSearch removed
                splitterType: 'TokenTextSplitter',
                chunkSize: 1024,
                chunkOverlap: 200,

                // Web Scraping (Updated defaults)
                enableWebSearch: true,
                // webSearchEngine removed
                depthLevel: 3, // Renamed from searchResultCount, max 5
                concurrentRequests: 10,
                bypassSslVerification: true,
                // youtubeLanguage removed
            };

            let currentModelWhitelist = [...defaultConfig.modelWhitelisting];

            function showToast(message, isError = false) {
                elements.toastMessage.textContent = message;
                elements.toast.classList.remove('bg-green-600', 'bg-red-600');
                elements.toast.classList.add(isError ? 'bg-red-600' : 'bg-green-600');
                elements.toast.classList.remove('invisible', 'opacity-0');
                
                setTimeout(() => {
                    elements.toast.classList.add('invisible', 'opacity-0');
                }, 3000);
            }

            function renderModelWhitelist() {
                elements.modelWhitelistContainer.innerHTML = '';
                if (elements.modelWhitelistingToggle.checked) {
                    currentModelWhitelist.forEach((model) => {
                        const div = document.createElement('div');
                        div.className = 'flex items-center justify-between bg-gray-600 p-2 rounded-md';
                        div.innerHTML = `
                            <span class="text-sm">${model}</span>
                            <button data-model="${model}" class="remove-model-btn text-red-400 hover:text-red-600 transition-colors duration-200">
                                &times;
                            </button>
                        `;
                        elements.modelWhitelistContainer.appendChild(div);
                    });
                }
            }

            function addModelToWhitelist() {
                const newModel = elements.newModelInput.value.trim();
                if (newModel && !currentModelWhitelist.includes(newModel)) {
                    currentModelWhitelist.push(newModel);
                    renderModelWhitelist();
                    elements.newModelInput.value = ''; // Clear input
                    elements.addModelModal.classList.add('hidden'); // Hide modal
                } else if (newModel) {
                    showToast('El modelo ya existe en la lista.', true);
                }
            }

            function removeModelFromWhitelist(event) {
                const modelToRemove = event.target.dataset.model;
                currentModelWhitelist = currentModelWhitelist.filter(model => model !== modelToRemove);
                renderModelWhitelist();
            }

            function saveConfiguration() {
                const currentConfig = {
                    // General
                    enableSignups: elements.enableSignups.checked,
                    defaultUserRole: elements.defaultUserRole.value,
                    jwtExpiration: parseInt(elements.jwtExpiration.value, 10),
                    webhookUrl: elements.webhookUrl.value,

                    // Usuarios
                    allowChatDeletion: elements.allowChatDeletion.checked,
                    savePrivateData: elements.savePrivateData.checked,
                    
                    // Modelos
                    defaultModel: elements.defaultModel.value,
                    modelWhitelisting: elements.modelWhitelistingToggle.checked ? currentModelWhitelist : [],

                    // Ingesta
                    vectorDbClient: elements.vectorDbClient.value,
                    vectorDbUrl: elements.vectorDbUrl.value,
                    vectorDbAccessToken: elements.vectorDbAccessToken.value,
                    vectorDbCollection: elements.vectorDbCollection.value,
                    optimizationScenario: elements.optimizationScenario.value,
                    hnswEf: parseInt(elements.hnswEf.value, 10),
                    retrieveFragments: parseInt(elements.retrieveFragments.value, 10),
                    // exactSearch removed
                    splitterType: elements.splitterType.value,
                    chunkSize: parseInt(elements.chunkSize.value, 10),
                    chunkOverlap: parseInt(elements.chunkOverlap.value, 10),

                    // Web Scraping
                    enableWebSearch: elements.enableWebSearch.checked,
                    // webSearchEngine removed
                    depthLevel: parseInt(elements.depthLevel.value, 10), // Renamed
                    concurrentRequests: parseInt(elements.concurrentRequests.value, 10),
                    bypassSslVerification: elements.bypassSslVerification.checked,
                    // youtubeLanguage removed
                };
                
                console.log('Guardando configuraci√≥n:', currentConfig);
                showToast('Configuraci√≥n guardada exitosamente.');
            }

            function resetToDefaults() {
                // General
                if (elements.enableSignups) elements.enableSignups.checked = defaultConfig.enableSignups;
                if (elements.defaultUserRole) elements.defaultUserRole.value = defaultConfig.defaultUserRole;
                if (elements.jwtExpiration) elements.jwtExpiration.value = defaultConfig.jwtExpiration;
                if (elements.webhookUrl) elements.webhookUrl.value = defaultConfig.webhookUrl;

                // Usuarios
                if (elements.allowChatDeletion) elements.allowChatDeletion.checked = defaultConfig.allowChatDeletion;
                if (elements.savePrivateData) elements.savePrivateData.checked = defaultConfig.savePrivateData;
                
                // Modelos
                if (elements.defaultModel) elements.defaultModel.value = defaultConfig.defaultModel;
                if (elements.modelWhitelistingToggle) elements.modelWhitelistingToggle.checked = true; // Assume whitelisting is enabled by default
                currentModelWhitelist = [...defaultConfig.modelWhitelisting];
                renderModelWhitelist(); // Re-render whitelist after reset
                
                // Ingesta
                if (elements.vectorDbClient) elements.vectorDbClient.value = defaultConfig.vectorDbClient;
                if (elements.vectorDbUrl) elements.vectorDbUrl.value = defaultConfig.vectorDbUrl;
                if (elements.vectorDbAccessToken) elements.vectorDbAccessToken.value = defaultConfig.vectorDbAccessToken;
                if (elements.vectorDbCollection) elements.vectorDbCollection.value = defaultConfig.vectorDbCollection;
                if (elements.optimizationScenario) elements.optimizationScenario.value = defaultConfig.optimizationScenario;
                if (elements.hnswEf) elements.hnswEf.value = defaultConfig.hnswEf;
                if (elements.retrieveFragments) elements.retrieveFragments.value = defaultConfig.retrieveFragments;
                // exactSearch removed
                if (elements.splitterType) elements.splitterType.value = defaultConfig.splitterType;
                if (elements.chunkSize) elements.chunkSize.value = defaultConfig.chunkSize;
                if (elements.chunkOverlap) elements.chunkOverlap.value = defaultConfig.chunkOverlap;

                // Web Scraping
                if (elements.enableWebSearch) elements.enableWebSearch.checked = defaultConfig.enableWebSearch;
                // webSearchEngine removed
                if (elements.depthLevel) elements.depthLevel.value = defaultConfig.depthLevel; // Renamed
                if (elements.concurrentRequests) elements.concurrentRequests.value = defaultConfig.concurrentRequests;
                if (elements.bypassSslVerification) elements.bypassSslVerification.checked = defaultConfig.bypassSslVerification;
                // youtubeLanguage removed
                
                showToast('Configuraci√≥n restablecida a los valores predeterminados.', false);
            }

            function activatePanel(panelName) {
                console.log('Activando panel:', panelName); // Debugging log

                // Remove 'active' class from all navigation buttons
                for (const key in elements.navButtons) {
                    if (elements.navButtons.hasOwnProperty(key)) {
                        elements.navButtons[key].classList.remove('active');
                    }
                }

                // Hide all content panels
                for (const key in elements.contentPanels) {
                    if (elements.contentPanels.hasOwnProperty(key)) {
                        elements.contentPanels[key].classList.remove('active');
                    }
                }

                // Add 'active' class to the selected navigation button
                if (elements.navButtons[panelName]) {
                    elements.navButtons[panelName].classList.add('active');
                } else {
                    console.error('Bot√≥n de navegaci√≥n no encontrado para el panel:', panelName);
                }

                // Show the selected content panel
                if (elements.contentPanels[panelName]) {
                    elements.contentPanels[panelName].classList.add('active');
                } else {
                    console.error('Panel de contenido no encontrado para el panel:', panelName);
                }
            }

            // Event Listeners
            elements.saveButton.addEventListener('click', saveConfiguration);
            elements.resetButton.addEventListener('click', resetToDefaults);

            // Model Whitelisting event listeners (now in Modelos panel)
            if (elements.modelWhitelistingToggle) elements.modelWhitelistingToggle.addEventListener('change', renderModelWhitelist);
            if (elements.addModelToWhitelistButton) elements.addModelToWhitelistButton.addEventListener('click', () => {
                elements.addModelModal.classList.remove('hidden'); // Show modal
                elements.newModelInput.focus(); // Focus input field
            });
            if (elements.cancelAddModelButton) elements.cancelAddModelButton.addEventListener('click', () => {
                elements.addModelModal.classList.add('hidden'); // Hide modal
                elements.newModelInput.value = ''; // Clear input
            });
            if (elements.confirmAddModelButton) elements.confirmAddModelButton.addEventListener('click', addModelToWhitelist);

            elements.navButtons.general.addEventListener('click', (e) => { e.preventDefault(); activatePanel('general'); });
            elements.navButtons.usuarios.addEventListener('click', (e) => { e.preventDefault(); activatePanel('usuarios'); });
            elements.navButtons.modelos.addEventListener('click', (e) => { e.preventDefault(); activatePanel('modelos'); }); // New event listener
            elements.navButtons.ingesta.addEventListener('click', (e) => { e.preventDefault(); activatePanel('ingesta'); });
            elements.navButtons.webScraping.addEventListener('click', (e) => { e.preventDefault(); activatePanel('webScraping'); });

            // Initial setup
            resetToDefaults();
            activatePanel('general'); // Activate the 'General' panel by default
            showToast('Valores predeterminados cargados.', false);
        });
    </script>

</body>
</html>
